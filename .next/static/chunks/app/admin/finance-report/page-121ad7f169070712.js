(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{9004:function(e,t,s){Promise.resolve().then(s.bind(s,5903))},5903:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(7437),n=s(2265),r=s(9376),l=s(7648),i=s(9203);function c(e){return e.toLocaleString("vi-VN")+" ₫"}function d(){let e=(0,r.useRouter)(),[t,s]=(0,n.useState)([]),[d,o]=(0,n.useState)(0),[u,x]=(0,n.useState)(0),[m,h]=(0,n.useState)(!0);async function f(){let{data:{user:t}}=await i.O.auth.getUser();if(!t){e.push("/debug-login");return}let{data:s}=await i.O.from("profiles").select("role").eq("id",t.id).single();(null==s?void 0:s.role)&&["admin","mod_finance"].includes(s.role)||e.push("/")}async function p(){h(!0);try{let{data:e,error:t}=await i.O.from("transactions").select("type, amount");if(t){console.error("Error:",t);return}let a={};(e||[]).forEach(e=>{a[e.type]||(a[e.type]={total:0,count:0}),a[e.type].total+=e.amount,a[e.type].count+=1});let n=Object.entries(a).map(e=>{let[t,s]=e;return{type:t,total:s.total,count:s.count}});s(n);let r=n.filter(e=>["fund_collection","donation"].includes(e.type)).reduce((e,t)=>e+t.total,0),l=n.filter(e=>["expense","fine","reward_payout"].includes(e.type)).reduce((e,t)=>e+t.total,0);o(r),x(l)}catch(e){console.error("Error:",e)}finally{h(!1)}}(0,n.useEffect)(()=>{f(),p()},[]);let g=d-u;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-6 px-4",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCCA B\xe1o C\xe1o Quỹ"}),(0,a.jsx)(l.default,{href:"/admin",className:"text-blue-100 hover:text-white",children:"← Quay lại"})]})})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:m?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Đang tải b\xe1o c\xe1o..."})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Thu Nhập"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600 mt-2",children:c(d)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Chi Ti\xeau"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600 mt-2",children:c(u)})]}),(0,a.jsxs)("div",{className:"rounded-lg shadow-md p-6 ".concat(g>=0?"bg-green-50":"bg-red-50"),children:[(0,a.jsx)("p",{className:"text-sm ".concat(g>=0?"text-green-600":"text-red-600"),children:"Số Dư"}),(0,a.jsx)("p",{className:"text-2xl font-bold mt-2 ".concat(g>=0?"text-green-600":"text-red-600"),children:c(g)})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Tổng Giao Dịch"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:t.reduce((e,t)=>e+t.count,0)})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Chi Tiết Theo Loại"}),(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>{let t=d+u>0?(e.total/(d+u)*100).toFixed(1):"0";return(0,a.jsxs)("div",{className:"border-b border-gray-200 pb-4 last:border-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:{fund_collection:"Thu Quỹ",fine:"Phạt",donation:"Quy\xean G\xf3p",expense:"Chi Ti\xeau",reward_payout:"Thưởng"}[e.type]||e.type}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-bold text-gray-900",children:c(e.total)}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[e.count," giao dịch"]})]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:"".concat(t,"%")}})}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[t,"% của tổng"]})]},e.type)})})]})]})})]})}},9203:function(e,t,s){"use strict";s.d(t,{O:function(){return l}});var a=s(7421);let n="https://jvnpxcwjfidrlqlfmuvl.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!n||!r)throw Error("Missing Supabase environment variables");let l=(0,a.eI)(n,r)},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var a=s(2972),n=s.n(a)},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[421,972,971,117,744],function(){return e(e.s=9004)}),_N_E=e.O()}]);