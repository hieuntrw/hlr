(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[192],{9449:function(e,t,n){Promise.resolve().then(n.bind(n,944))},944:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var s=n(7437),a=n(2265),r=n(9376),i=n(7648),l=n(9203);function o(e){return e.toLocaleString("vi-VN")+" ₫"}function c(){let e=(0,r.useRouter)(),[t,n]=(0,a.useState)([]),[c,d]=(0,a.useState)(!0),[u,x]=(0,a.useState)(null),[h,p]=(0,a.useState)(null);async function m(){let{data:{user:t}}=await l.O.auth.getUser();if(!t){e.push("/debug-login");return}let{data:n}=await l.O.from("profiles").select("role").eq("id",t.id).single();(null==n?void 0:n.role)&&["admin","mod_finance"].includes(n.role)?x(n.role):e.push("/")}async function g(){d(!0);try{let e=l.O.from("transactions").select("id, user_id, type, amount, description, transaction_date, payment_status, profiles(full_name)").order("transaction_date",{ascending:!1});h&&(e=e.eq("type",h));let{data:t,error:s}=await e;if(s){console.error("Error fetching transactions:",s);return}n((null==t?void 0:t.map(e=>({id:e.id,user_id:e.user_id,type:e.type,amount:e.amount,description:e.description,transaction_date:e.transaction_date,payment_status:e.payment_status,profile:e.profiles})))||[])}catch(e){console.error("Error:",e)}finally{d(!1)}}(0,a.useEffect)(()=>{m(),g()},[]),(0,a.useEffect)(()=>{g()},[h]);let f=t.filter(e=>["fund_collection","donation"].includes(e.type)).reduce((e,t)=>e+t.amount,0),b=t.filter(e=>["expense","fine","reward_payout"].includes(e.type)).reduce((e,t)=>e+t.amount,0),y=f-b;return u?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-6 px-4",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"\uD83D\uDCB0 Quản L\xfd Thu/Chi"}),(0,s.jsx)(i.default,{href:"/admin",className:"text-blue-100 hover:text-white",children:"← Quay lại"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-100",children:"Thu Nhập"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(f)})]}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-100",children:"Chi Ti\xeau"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(b)})]}),(0,s.jsxs)("div",{className:"".concat(y>=0?"bg-green-500/20":"bg-red-500/20"," rounded-lg p-4"),children:[(0,s.jsx)("p",{className:"text-white/80",children:"Số Dư"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(y)})]})]})]})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-6 flex gap-2 overflow-x-auto pb-2",children:[(0,s.jsx)("button",{onClick:()=>p(null),className:"px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ".concat(null===h?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"Tất Cả"}),(0,s.jsx)("button",{onClick:()=>p("fund_collection"),className:"px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ".concat("fund_collection"===h?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"Thu Quỹ"}),(0,s.jsx)("button",{onClick:()=>p("fine"),className:"px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ".concat("fine"===h?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"Phạt"}),(0,s.jsx)("button",{onClick:()=>p("expense"),className:"px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ".concat("expense"===h?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"Chi Ti\xeau"}),(0,s.jsx)("button",{onClick:()=>p("reward_payout"),className:"px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition-colors ".concat("reward_payout"===h?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"Thưởng"})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:c?(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Đang tải dữ liệu..."})}):t.length>0?(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b-2 border-gray-300 bg-gray-50",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Ng\xe0y"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Loại"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Th\xe0nh Vi\xean"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"M\xf4 Tả"}),(0,s.jsx)("th",{className:"text-right py-3 px-4 font-bold text-gray-700",children:"Số Tiền"}),(0,s.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Trạng Th\xe1i"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>{var t,n;return(0,s.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"py-3 px-4",children:new Date(e.transaction_date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-semibold ".concat({fund_collection:"bg-blue-100 text-blue-800",fine:"bg-red-100 text-red-800",donation:"bg-green-100 text-green-800",expense:"bg-orange-100 text-orange-800",reward_payout:"bg-purple-100 text-purple-800"}[e.type]||"bg-gray-100 text-gray-800"),children:{fund_collection:"Thu Quỹ",fine:"Phạt",donation:"Quy\xean G\xf3p",expense:"Chi Ti\xeau",reward_payout:"Thưởng"}[n=e.type]||n})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(null===(t=e.profile)||void 0===t?void 0:t.full_name)||"---"}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.description}),(0,s.jsxs)("td",{className:"py-3 px-4 text-right font-bold",children:[["expense","fine","reward_payout"].includes(e.type)?"-":"+",o(e.amount)]}),(0,s.jsx)("td",{className:"py-3 px-4 text-center",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 rounded text-xs font-semibold ".concat("paid"===e.payment_status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:"paid"===e.payment_status?"✓ Đ\xe3 thanh to\xe1n":"⏳ Chờ"})})]},e.id)})})]}):(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Kh\xf4ng c\xf3 giao dịch n\xe0o"})})})]})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Đang kiểm tra quyền..."})})}},9203:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});var s=n(7421);let a="https://jvnpxcwjfidrlqlfmuvl.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!a||!r)throw Error("Missing Supabase environment variables");let i=(0,s.eI)(a,r)},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var s=n(2972),a=n.n(s)},9376:function(e,t,n){"use strict";var s=n(5475);n.o(s,"usePathname")&&n.d(t,{usePathname:function(){return s.usePathname}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[421,972,971,117,744],function(){return e(e.s=9449)}),_N_E=e.O()}]);