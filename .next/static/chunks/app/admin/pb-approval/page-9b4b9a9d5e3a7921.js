(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{9897:function(e,t,r){Promise.resolve().then(r.bind(r,7081))},7081:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),s=r(2265),a=r(9376),i=r(7648),c=r(9203);function l(){let e=(0,a.useRouter)(),[t,r]=(0,s.useState)([]),[l,d]=(0,s.useState)(!0);async function o(){let{data:{user:t}}=await c.O.auth.getUser();if(!t){e.push("/debug-login");return}let{data:r}=await c.O.from("profiles").select("role").eq("id",t.id).single();(null==r?void 0:r.role)&&["admin","mod_member"].includes(r.role)||e.push("/")}async function h(){d(!0);try{let{data:e,error:t}=await c.O.from("pb_history").select("id, user_id, distance, time_seconds, achieved_at, evidence_link, profiles(full_name)").not("evidence_link","is",null).order("achieved_at",{ascending:!1});if(t){console.error("Error:",t);return}r((null==e?void 0:e.map(e=>({id:e.id,user_id:e.user_id,distance:e.distance,time_seconds:e.time_seconds,achieved_at:e.achieved_at,evidence_link:e.evidence_link,profile:e.profiles})))||[])}catch(e){console.error("Error:",e)}finally{d(!1)}}async function x(e,r){try{let n=t.find(t=>t.id===e);if(!n)return;await c.O.from("profiles").update({["HM"===r?"pb_hm_approved":"pb_fm_approved"]:!0}).eq("id",n.user_id),alert("Đ\xe3 duyệt th\xe0nh t\xedch!"),h()}catch(e){console.error("Error:",e),alert("Lỗi khi duyệt th\xe0nh t\xedch")}}async function u(e){try{await c.O.from("pb_history").delete().eq("id",e),alert("Đ\xe3 từ chối th\xe0nh t\xedch!"),h()}catch(e){console.error("Error:",e),alert("Lỗi khi từ chối")}}return(0,s.useEffect)(()=>{o(),h()},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-6 px-4",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold",children:"✅ Duyệt Th\xe0nh T\xedch C\xe1 Nh\xe2n"}),(0,n.jsx)(i.default,{href:"/admin",className:"text-blue-100 hover:text-white",children:"← Quay lại"})]})})}),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-x-auto",children:l?(0,n.jsx)("div",{className:"p-8 text-center",children:(0,n.jsx)("p",{className:"text-gray-600",children:"Đang tải..."})}):t.length>0?(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b-2 border-gray-300 bg-gray-50",children:[(0,n.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Th\xe0nh Vi\xean"}),(0,n.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Cự Ly"}),(0,n.jsx)("th",{className:"text-right py-3 px-4 font-bold text-gray-700",children:"Thời Gian"}),(0,n.jsx)("th",{className:"text-right py-3 px-4 font-bold text-gray-700",children:"Pace"}),(0,n.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Ng\xe0y"}),(0,n.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Bằng Chứng"}),(0,n.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"H\xe0nh Động"})]})}),(0,n.jsx)("tbody",{children:t.map(e=>{var t,r;return(0,n.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[(0,n.jsx)("td",{className:"py-3 px-4 font-semibold",children:null===(t=e.profile)||void 0===t?void 0:t.full_name}),(0,n.jsx)("td",{className:"py-3 px-4 text-center",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-semibold",children:"HM"===e.distance?"HM (21km)":"FM (42km)"})}),(0,n.jsx)("td",{className:"py-3 px-4 text-right font-bold text-blue-600",children:(r=e.time_seconds,"".concat(Math.floor(r/3600).toString().padStart(2,"0"),":").concat(Math.floor(r%3600/60).toString().padStart(2,"0"),":").concat(Math.floor(r%60).toString().padStart(2,"0")))}),(0,n.jsx)("td",{className:"py-3 px-4 text-right text-gray-600",children:function(e,t){let r=1e3*e/("HM"===t?21:42);return"".concat(Math.floor(r/60),":").concat(Math.floor(r%60).toString().padStart(2,"0"),"/km")}(e.time_seconds,e.distance)}),(0,n.jsx)("td",{className:"py-3 px-4",children:new Date(e.achieved_at).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})}),(0,n.jsx)("td",{className:"py-3 px-4 text-center",children:(0,n.jsx)("a",{href:e.evidence_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 font-semibold",children:"\uD83D\uDD17 Xem"})}),(0,n.jsx)("td",{className:"py-3 px-4 text-center",children:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>x(e.id,e.distance),className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs font-semibold rounded transition-colors",children:"✓ Duyệt"}),(0,n.jsx)("button",{onClick:()=>u(e.id),className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded transition-colors",children:"✕ Từ Chối"})]})})]},e.id)})})]}):(0,n.jsx)("div",{className:"p-8 text-center",children:(0,n.jsx)("p",{className:"text-gray-500",children:"Kh\xf4ng c\xf3 th\xe0nh t\xedch n\xe0o chờ duyệt"})})}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 mt-4",children:["⏳ Chờ duyệt: ",(0,n.jsx)("span",{className:"font-bold",children:t.length})," th\xe0nh t\xedch"]})]})]})}},9203:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var n=r(7421);let s="https://jvnpxcwjfidrlqlfmuvl.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!s||!a)throw Error("Missing Supabase environment variables");let i=(0,n.eI)(s,a)},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(2972),s=r.n(n)},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[421,972,971,117,744],function(){return e(e.s=9897)}),_N_E=e.O()}]);