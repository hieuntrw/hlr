(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{7607:function(e,t,a){Promise.resolve().then(a.bind(a,112))},112:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(7437),r=a(2265),l=a(9203);function n(e){return e?new Date(e).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"}function i(e){return!e||isNaN(e)?"--:--:--":"".concat(Math.floor(e/3600).toString().padStart(2,"0"),":").concat(Math.floor(e%3600/60).toString().padStart(2,"0"),":").concat(Math.floor(e%60).toString().padStart(2,"0"))}function d(e){return!e||isNaN(e)?"--:--":"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"),"/km")}function c(e){let{isOpen:t,onClose:a,onSubmit:l,isLoading:n}=e,[i,d]=(0,r.useState)("21"),[c,o]=(0,r.useState)("01:30:00"),[x,h]=(0,r.useState)("");return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full p-6",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"Cập Nhật Th\xe0nh T\xedch C\xe1 Nh\xe2n"}),(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!c||!x){alert("Vui l\xf2ng điền đầy đủ th\xf4ng tin");return}l({distance:i,time:c,evidence_link:x}),o("01:30:00"),h("")},className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cự Ly"}),(0,s.jsxs)("select",{value:i,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"21",children:"Half Marathon (21 km)"}),(0,s.jsx)("option",{value:"42",children:"Full Marathon (42 km)"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Thời gian (HH:MM:SS)"}),(0,s.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"01:30:00",className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Link Bằng Chứng (Result Page)"}),(0,s.jsx)("input",{type:"url",value:x,onChange:e=>h(e.target.value),placeholder:"https://example.com/results",className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 bg-blue-50 p-3 rounded",children:"ℹ️ Th\xe0nh t\xedch n\xe0y sẽ được gửi cho Admin duyệt trước khi cập nhật"}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Hủy"}),(0,s.jsx)("button",{type:"submit",disabled:n,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:n?"Đang gửi...":"Gửi"})]})]})]})}):null}function o(){let[e,t]=(0,r.useState)(null),[a,o]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[m,g]=(0,r.useState)(!0),[u,p]=(0,r.useState)(!1),[b,f]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!1);async function v(){g(!0);try{let{data:{user:e}}=await l.O.auth.getUser();if(!e){window.location.href="/debug-login";return}let{data:a,error:s}=await l.O.from("profiles").select("id, full_name, avatar_url, join_date, device_name, strava_id, pb_hm_seconds, pb_fm_seconds, pb_hm_approved, pb_fm_approved").eq("id",e.id).single();if(s){console.error("Error fetching profile:",s);return}t(a),p(!!(null==a?void 0:a.strava_id));let r=new Date;r.setDate(r.getDate()-30);let{data:n,error:i}=await l.O.from("activities").select("id, name, distance, moving_time, average_heartrate, average_cadence, elevation_gain, start_date").eq("user_id",e.id).gte("start_date",r.toISOString()).order("start_date",{ascending:!1});if(i)console.error("Error fetching activities:",i);else if(n){o(n);let e={};n.forEach(t=>{let a=new Date(t.start_date).toLocaleDateString("vi-VN"),s=t.distance/1e3;e[a]=(e[a]||0)+s});let t=Object.entries(e).map(e=>{let[t,a]=e;return{date:t,km:a}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());h(t)}}catch(e){console.error("Unexpected error:",e)}finally{g(!1)}}async function N(){if(u){let{data:{user:e}}=await l.O.auth.getUser();e&&(await l.O.from("profiles").update({strava_id:null,strava_access_token:null,strava_refresh_token:null,strava_token_expires_at:null}).eq("id",e.id),p(!1),alert("Đ\xe3 ngắt kết nối Strava"))}else window.location.href="/api/auth/strava/login"}async function _(e){j(!0);try{let{data:{user:t}}=await l.O.auth.getUser();if(!t)return;let[a,s,r]=e.time.split(":").map(Number),{error:n}=await l.O.from("pb_history").insert({user_id:t.id,distance:"21"===e.distance?"HM":"FM",time_seconds:3600*a+60*s+r,achieved_at:new Date().toISOString().split("T")[0],evidence_link:e.evidence_link});n?(console.error("Error submitting PB:",n),alert("Lỗi khi gửi th\xe0nh t\xedch")):(alert("Th\xe0nh t\xedch đ\xe3 được gửi cho Admin duyệt!"),f(!1),v())}catch(e){console.error("Error:",e),alert("C\xf3 lỗi xảy ra")}finally{j(!1)}}if((0,r.useEffect)(()=>{v()},[]),m)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Đang tải dữ liệu..."})]})});if(!e)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"Kh\xf4ng t\xecm thấy hồ sơ"})})});let w=Math.max(...x.map(e=>e.km),10);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-8 px-4",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-6",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4 flex-1",children:[e.avatar_url?(0,s.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-24 h-24 rounded-full object-cover border-4 border-white"}):(0,s.jsx)("div",{className:"w-24 h-24 rounded-full bg-white/30 flex items-center justify-center border-4 border-white text-4xl",children:"\uD83D\uDC64"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-2",children:e.full_name}),(0,s.jsxs)("div",{className:"space-y-1 text-blue-100",children:[(0,s.jsxs)("p",{children:["\uD83D\uDCC5 Gia nhập: ",n(e.join_date)]}),(0,s.jsxs)("p",{children:["⌚ Thiết bị: ",e.device_name||"Chưa cập nhật"]})]})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("button",{onClick:N,className:"px-6 py-3 rounded-lg font-bold transition-all whitespace-nowrap ".concat(u?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"),children:u?"\uD83D\uDD17 Ngắt kết nối Strava":"\uD83D\uDD17 Kết nối Strava"})})]}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-white/20",children:u?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-100",children:[(0,s.jsx)("span",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,s.jsxs)("span",{children:["✓ Kết nối Strava: ",e.strava_id]})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-100",children:[(0,s.jsx)("span",{className:"w-3 h-3 bg-red-400 rounded-full"}),(0,s.jsx)("span",{children:"✗ Chưa kết nối Strava"})]})})]})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83C\uDFC3 PB Half Marathon (21km)"}),(0,s.jsx)("div",{className:"text-center py-6",children:e.pb_hm_seconds?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-5xl font-bold text-blue-600 mb-2",children:i(e.pb_hm_seconds)}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Pace: ",d(1e3*e.pb_hm_seconds/21)]}),e.pb_hm_approved?(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold",children:"✓ Đ\xe3 duyệt"}):(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold",children:"⏳ Chờ duyệt"})]}):(0,s.jsx)("p",{className:"text-gray-500",children:"Chưa c\xf3 th\xe0nh t\xedch"})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"\uD83C\uDFC3 PB Full Marathon (42km)"}),(0,s.jsx)("div",{className:"text-center py-6",children:e.pb_fm_seconds?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-5xl font-bold text-purple-600 mb-2",children:i(e.pb_fm_seconds)}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Pace: ",d(1e3*e.pb_fm_seconds/42)]}),e.pb_fm_approved?(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold",children:"✓ Đ\xe3 duyệt"}):(0,s.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-semibold",children:"⏳ Chờ duyệt"})]}):(0,s.jsx)("p",{className:"text-gray-500",children:"Chưa c\xf3 th\xe0nh t\xedch"})})]})]}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("button",{onClick:()=>f(!0),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"✏️ Cập Nhật Th\xe0nh T\xedch C\xe1 Nh\xe2n"})}),x.length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"\uD83D\uDCC8 Hoạt Động 30 Ng\xe0y Gần Nhất"}),(0,s.jsx)("div",{className:"h-80 flex items-end justify-start gap-1 overflow-x-auto pb-4",children:x.map((e,t)=>{let a=e.km/w*100;return(0,s.jsxs)("div",{className:"flex-shrink-0 flex flex-col items-center",title:"".concat(e.date,": ").concat(e.km.toFixed(1)," km"),children:[(0,s.jsx)("div",{className:"w-6 bg-gradient-to-t from-blue-500 to-blue-400 rounded-t transition-all hover:from-blue-600 hover:to-blue-500 cursor-pointer",style:{height:"".concat(a,"%"),minHeight:"4px"}}),(0,s.jsxs)("div",{className:"text-xs text-gray-600 mt-2 w-12 text-center truncate",children:[e.km.toFixed(0),"km"]})]},t)})}),(0,s.jsx)("div",{className:"text-center pt-4 border-t border-gray-200",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Tổng: ",(0,s.jsxs)("span",{className:"font-bold text-blue-600",children:[x.reduce((e,t)=>e+t.km,0).toFixed(1)," km"]})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"\uD83C\uDFC3 Lịch Sử Hoạt Động Gần Đ\xe2y"}),a.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b-2 border-gray-300",children:[(0,s.jsx)("th",{className:"text-left py-3 px-2 font-bold text-gray-700",children:"T\xean Hoạt Động"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Qu\xe3ng Đường"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Thời Gian"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Pace"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Nhịp Tim"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Cadence"}),(0,s.jsx)("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Elevation"}),(0,s.jsx)("th",{className:"text-left py-3 px-2 font-bold text-gray-700",children:"Ng\xe0y"})]})}),(0,s.jsx)("tbody",{children:a.map(e=>{let t=e.distance/1e3,a=e.distance>0?1e3*e.moving_time/e.distance:0;return(0,s.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"py-3 px-2 font-semibold text-gray-900",children:e.name}),(0,s.jsxs)("td",{className:"py-3 px-2 text-right text-blue-600 font-semibold",children:[t.toFixed(2)," km"]}),(0,s.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:i(e.moving_time)}),(0,s.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:d(a)}),(0,s.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:e.average_heartrate?"".concat(Math.round(e.average_heartrate)," bpm"):"N/A"}),(0,s.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:e.average_cadence?"".concat(Math.round(e.average_cadence)):"N/A"}),(0,s.jsx)("td",{className:"py-3 px-2 text-right text-gray-600",children:e.elevation_gain?"".concat(Math.round(e.elevation_gain)," m"):"N/A"}),(0,s.jsx)("td",{className:"py-3 px-2 text-gray-600",children:n(e.start_date)})]},e.id)})})]})}):(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Chưa c\xf3 hoạt động n\xe0o trong 30 ng\xe0y gần nhất"})})]})]}),(0,s.jsx)(c,{isOpen:b,onClose:()=>f(!1),onSubmit:_,isLoading:y})]})}},9203:function(e,t,a){"use strict";a.d(t,{O:function(){return n}});var s=a(7421);let r="https://jvnpxcwjfidrlqlfmuvl.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!r||!l)throw Error("Missing Supabase environment variables");let n=(0,s.eI)(r,l)}},function(e){e.O(0,[421,971,117,744],function(){return e(e.s=7607)}),_N_E=e.O()}]);