(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8260:function(e,t,a){Promise.resolve().then(a.bind(a,6368))},6368:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),r=a(2265),n=a(9376),l=a(4196);function i(e){let{rank:t,name:a,avatar:r,totalKm:n,pace:l,targetKm:i}=e,c=Math.min(n/i*100,100);return(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-white ".concat(1===t?"bg-yellow-500":2===t?"bg-gray-400":3===t?"bg-orange-500":"bg-gray-300"),children:t}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-full flex items-center justify-center text-white font-bold",children:r||a.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:a}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"".concat(Math.floor(l/60),":").concat(Math.round(l%60).toString().padStart(2,"0"),"/km")})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("span",{className:"font-semibold text-gray-900",children:[n," km"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[Math.round(c),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-full transition-all ".concat(c>=100?"bg-green-500":c>=75?"bg-blue-500":c>=50?"bg-amber-500":"bg-red-500"),style:{width:"".concat(c,"%")}})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Mục ti\xeau: ",i," km"]})]}),n>=i&&(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"✓ Ho\xe0n th\xe0nh"})})]})})}var c=a(9203);function d(){var e;let t=(0,n.useSearchParams)().get("strava_connected"),[a,d]=(0,r.useState)([]),[h,m]=(0,r.useState)(""),[o,x]=(0,r.useState)(!0),[g,u]=(0,r.useState)(!1),[b,p]=(0,r.useState)(null),[f,j]=(0,r.useState)(null),[y,v]=(0,r.useState)({totalKm:0,avgPace:null,targetKm:0,progressPercent:0});async function N(){x(!0),m("Th\xe1ch thức th\xe1ng 11/2025"),d([{rank:1,name:"Nguyễn Hải Đăng",totalKm:285,pace:420,targetKm:300},{rank:2,name:"Trần Quốc Việt",totalKm:270,pace:450,targetKm:300},{rank:3,name:"Phạm Thị Hương",totalKm:255,pace:480,targetKm:300},{rank:4,name:"B\xf9i Anh Tuấn",totalKm:240,pace:435,targetKm:250},{rank:5,name:"L\xea Minh H\xf2a",totalKm:235,pace:465,targetKm:300},{rank:6,name:"Ho\xe0ng Minh Kh\xe1nh",totalKm:220,pace:500,targetKm:250},{rank:7,name:"Đỗ Thị Lan",totalKm:210,pace:510,targetKm:200},{rank:8,name:"Vũ Quang Huy",totalKm:195,pace:520,targetKm:250},{rank:9,name:"L\xfd Tuấn Anh",totalKm:180,pace:540,targetKm:200},{rank:10,name:"Trịnh Minh Đức",totalKm:165,pace:560,targetKm:200}]),x(!1)}async function w(){try{let e=new Date,t=e.getMonth()+1,a=e.getFullYear(),s=new Date(Date.UTC(a,t-1,1)).toISOString().slice(0,10),r=new Date(Date.UTC(a,t,0)).toISOString().slice(0,10),{data:{user:n}}=await c.O.auth.getUser();if(!n)return;let{data:l}=await c.O.from("challenges").select("id").gte("start_date",s).lte("start_date",r).limit(1).maybeSingle();if(!l)return;let{data:i}=await c.O.from("challenge_participants").select("actual_km, avg_pace_seconds, target_km").eq("challenge_id",l.id).eq("user_id",n.id).maybeSingle();if(i){let e=Number(i.actual_km)||0,t=Number(i.target_km)||0,a=Number(i.avg_pace_seconds)||0,s=a>0?"".concat(Math.floor(a/60),":").concat(String(a%60).padStart(2,"0")):null;v({totalKm:e,avgPace:s,targetKm:t,progressPercent:t>0?Math.round(e/t*100):0})}}catch(e){console.error("Failed to fetch personal stats:",e)}}async function k(){try{let{data:{user:e}}=await c.O.auth.getUser();if(!e)return;let{data:t}=await c.O.from("profiles").select("id, full_name, strava_id").eq("id",e.id).maybeSingle();t&&j(t)}catch(e){console.error("Failed to fetch user profile:",e)}}(0,r.useEffect)(()=>{N(),k(),w(),async function(){try{u(!0),p(null);let e=await fetch("/api/strava/sync",{method:"POST"});if(e.ok)await e.json(),p("Đồng bộ th\xe0nh c\xf4ng"),await N(),await w();else{let t=await e.json().catch(()=>({}));p((null==t?void 0:t.error)||"Đồng bộ thất bại")}}catch(e){p("Đồng bộ thất bại")}finally{u(!1)}}()},[]);let S=async()=>{u(!0),p(null);try{let e=await fetch("/api/strava/sync",{method:"POST"});if(e.ok)await e.json(),p("Đồng bộ th\xe0nh c\xf4ng"),await N(),await w();else{let t=await e.json().catch(()=>({}));p((null==t?void 0:t.error)||"Đồng bộ thất bại")}}catch(e){p("Đồng bộ thất bại")}finally{u(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[!f&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-900",children:"Bạn chưa đăng nhập"}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"Vui l\xf2ng đăng nhập bằng email của th\xe0nh vi\xean để kết nối Strava v\xe0 đồng bộ hoạt động."})]}),(0,s.jsx)("div",{children:(0,s.jsx)("a",{href:"/profile",className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Đăng nhập / Hồ sơ"})})]}),f&&(0,s.jsx)("div",{className:"mb-8 p-6 bg-gradient-to-r from-primary-500 to-blue-500 rounded-lg text-white",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Ch\xe0o mừng, ",f.full_name||"Runner","! \uD83C\uDFC3"]}),(0,s.jsx)("p",{className:"text-primary-100",children:f.strava_id?"Kết nối Strava đ\xe3 được thiết lập. Dữ liệu của bạn sẽ được cập nhật tự động.":"H\xe3y kết nối Strava để bắt đầu theo d\xf5i hoạt động"})]})})}),f&&!f.strava_id&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-orange-900",children:"Chưa kết nối Strava"}),(0,s.jsx)("p",{className:"text-sm text-orange-700",children:"Bạn đ\xe3 đăng nhập nhưng chưa li\xean kết t\xe0i khoản Strava. Nhấn n\xfat b\xean để bắt đầu li\xean kết (Strava OAuth)."})]}),(0,s.jsx)("div",{children:(0,s.jsx)("a",{href:"/api/auth/strava/login",className:"px-4 py-2 bg-orange-500 text-white rounded-md",children:"Kết nối Strava"})})]}),t&&(0,s.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:"✓"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-green-900",children:"Kết nối Strava th\xe0nh c\xf4ng!"}),(0,s.jsx)("p",{className:"text-sm text-green-700",children:"Dữ liệu hoạt động của bạn sẽ được cập nhật tự động"})]})]}),(0,s.jsxs)("div",{className:"mb-8 bg-gradient-to-r from-primary-50 to-blue-50 rounded-lg border border-primary-200 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Thống k\xea c\xe1 nh\xe2n th\xe1ng n\xe0y"}),(0,s.jsxs)("button",{onClick:S,disabled:g,className:"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-md hover:brightness-95 disabled:opacity-60 transition",children:[g?(0,s.jsx)("svg",{className:"w-4 h-4 animate-spin",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"rgba(255,255,255,0.6)",strokeWidth:"4"})}):(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 4v4m0 8v4M4 12h4m8 0h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:g?"Đang đồng bộ...":"Đồng bộ ngay"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Tổng KM th\xe1ng n\xe0y"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-primary-600",children:y.totalKm.toFixed(1)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["/ ",y.targetKm," km"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Pace trung b\xecnh"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-primary-600",children:y.avgPace||"—"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ph\xfat / km"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"% Ho\xe0n th\xe0nh"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-primary-600",children:[y.progressPercent,"%"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"của mục ti\xeau"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-700",children:"Tiến độ"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[y.totalKm.toFixed(1)," / ",y.targetKm," km"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-full transition-all ".concat((e=y.progressPercent)>=100?"bg-purple-600":e>=80?"bg-green-600":e>=50?"bg-yellow-500":"bg-red-600"),style:{width:"".concat(Math.min(y.progressPercent,100),"%")}})}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:y.progressPercent>=100?"\uD83C\uDF89 Bạn đ\xe3 vượt qu\xe1 mục ti\xeau!":y.progressPercent>=80?"✓ Gần ho\xe0n th\xe0nh!":y.progressPercent>=50?"Tiếp tục cố gắng!":"Bắt đầu n\xe0o!"})]}),b&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-4 text-center",children:b})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:h}),(0,s.jsx)("p",{className:"text-gray-600",children:"Top 10 th\xe0nh vi\xean với tiến độ ho\xe0n th\xe0nh cao nhất"})]}),o?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Đang tải dữ liệu..."})}):(0,s.jsx)("div",{className:"space-y-3",children:a.map(e=>(0,s.jsx)(i,{...e},e.rank))}),(0,s.jsxs)("div",{className:"mt-12 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Tổng th\xe0nh vi\xean"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:"10"}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"đang tham gia"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Ho\xe0n th\xe0nh th\xe1ch thức"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-green-600",children:"3"}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"30% ho\xe0n th\xe0nh"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Tổng km chạy"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-primary-600",children:"2,255"}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"từ tất cả th\xe0nh vi\xean"})]})]})]})]})}function h(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Đang tải..."})}),children:(0,s.jsx)(d,{})})}},4196:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(7437);function r(){return(0,s.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-primary-600",children:"\uD83C\uDFC3"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"HLR Running Club"})]}),(0,s.jsxs)("nav",{className:"flex gap-6",children:[(0,s.jsx)("a",{href:"/dashboard",className:"text-gray-700 hover:text-primary-600 transition",children:"Bảng xếp hạng"}),(0,s.jsx)("a",{href:"/profile",className:"text-gray-700 hover:text-primary-600 transition",children:"T\xe0i khoản"}),(0,s.jsx)("a",{href:"/rules",className:"text-gray-700 hover:text-primary-600 transition",children:"Quy định"})]})]})})})}},9203:function(e,t,a){"use strict";a.d(t,{O:function(){return l}});var s=a(7421);let r="https://jvnpxcwjfidrlqlfmuvl.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!r||!n)throw Error("Missing Supabase environment variables");let l=(0,s.eI)(r,n)},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[421,971,117,744],function(){return e(e.s=8260)}),_N_E=e.O()}]);