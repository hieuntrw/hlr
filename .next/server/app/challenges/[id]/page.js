(()=>{var e={};e.id=57,e.ids=[57],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2256:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>d}),s(7525),s(2222),s(5866);var a=s(3191),r=s(8716),l=s(7922),n=s.n(l),i=s(5231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let d=["",{children:["challenges",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7525)),"/workspaces/hlr/app/challenges/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2222)),"/workspaces/hlr/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/workspaces/hlr/app/challenges/[id]/page.tsx"],x="/challenges/[id]/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/challenges/[id]/page",pathname:"/challenges/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},626:(e,t,s)=>{Promise.resolve().then(s.bind(s,3228))},1350:(e,t,s)=>{Promise.resolve().then(s.bind(s,7553))},372:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},3228:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(326),r=s(7577),l=s(434),n=s(1579);function i(e){return new Date(e).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})}function c(e){return isNaN(e)||e<0?"--:--":`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}/km`}function d({params:e}){let[t,s]=(0,r.useState)(null),[d,o]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[m,u]=(0,r.useState)(!0),[g,p]=(0,r.useState)(null),[f,b]=(0,r.useState)(null),[j,y]=(0,r.useState)(null),[_,N]=(0,r.useState)(!1);async function v(){u(!0);let{data:{user:t}}=await n.O.auth.getUser();b(t?.id||null);try{let{data:a,error:r}=await n.O.from("challenges").select("id, title, description, start_date, end_date, password, status, is_locked, min_pace_seconds, max_pace_seconds").eq("id",e.id).single();if(r){console.error("Error fetching challenge:",r);return}s(a);let{data:l,error:i}=await n.O.from("challenge_participants").select(`
          user_id,
          target_km,
          actual_km,
          avg_pace_seconds,
          total_activities,
          profiles(full_name, avatar_url, gender)
        `).eq("challenge_id",e.id).order("actual_km",{ascending:!1});if(i?console.error("Error fetching participants:",i):l&&o(l.map(e=>({user_id:e.user_id,target_km:e.target_km,actual_km:e.actual_km,avg_pace_seconds:e.avg_pace_seconds,total_activities:e.total_activities,profile:e.profiles}))),"Closed"===a.status){let{data:t,error:s}=await n.O.from("lucky_draws").select(`
          id,
          winner_user_id,
          prize_name,
          rank,
          profiles!lucky_draws_winner_user_id_fkey(full_name, avatar_url)
        `).eq("challenge_id",e.id).not("winner_user_id","is",null).order("rank",{ascending:!0}).limit(2);s?console.error("Error fetching lucky draws:",s):t&&h(t.map(e=>({id:e.id,winner_user_id:e.winner_user_id,prize_name:e.prize_name,rank:e.rank,winner_profile:e.profiles})))}if(t?.id){let{data:s}=await n.O.from("challenge_participants").select("*").eq("challenge_id",e.id).eq("user_id",t.id).single();s&&(p(s),y(s.target_km))}}catch(e){console.error("Error:",e)}finally{u(!1)}}async function w(){if(j&&f){N(!0);try{if(g){let{error:e}=await n.O.from("challenge_participants").update({target_km:j}).eq("id",g.id);e?(console.error("Error updating participation:",e),alert("Lỗi khi cập nhật mục ti\xeau")):(alert("Cập nhật mục ti\xeau th\xe0nh c\xf4ng!"),p({...g,target_km:j}))}else{let{error:t}=await n.O.from("challenge_participants").insert({challenge_id:e.id,user_id:f,target_km:j,actual_km:0,avg_pace_seconds:0,total_activities:0});t?(console.error("Error registering:",t),alert("Lỗi khi đăng k\xfd thử th\xe1ch")):(alert("Đăng k\xfd thử th\xe1ch th\xe0nh c\xf4ng!"),v())}}catch(e){console.error("Error:",e),alert("C\xf3 lỗi xảy ra")}finally{N(!1)}}}return m?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Đang tải dữ liệu..."})]})}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-8 px-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[a.jsx(l.default,{href:"/challenges",className:"text-blue-100 hover:text-white mb-4 inline-block",children:"← Quay lại"}),a.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2",children:t.title}),(0,a.jsxs)("p",{className:"text-blue-100",children:[i(t.start_date)," - ",i(t.end_date)]})]})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold mb-4",children:"\uD83D\uDCCB Th\xf4ng Tin"}),a.jsx("p",{className:"text-gray-700 whitespace-pre-wrap mb-4",children:t.description}),a.jsx("div",{className:"space-y-2 text-sm",children:(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-semibold text-gray-700",children:"Pace Range:"}),(0,a.jsxs)("span",{className:"text-gray-600",children:[" ",c(t.min_pace_seconds)," -"," ",c(t.max_pace_seconds)]})]})})]}),"Open"===t.status&&(0,a.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg shadow-md p-6 border-2 border-green-300",children:[a.jsx("h3",{className:"text-xl font-bold text-green-900 mb-4",children:"\uD83C\uDFAF Chọn Mục Ti\xeau"}),a.jsx("div",{className:"space-y-3 mb-6",children:[70,100,150,200,250,300].map(e=>(0,a.jsxs)("label",{className:`flex items-center p-3 border-2 rounded-lg cursor-pointer transition-all ${j===e?"border-green-600 bg-green-100":"border-green-200 hover:border-green-400"}`,children:[a.jsx("input",{type:"radio",name:"target",value:e,checked:j===e,onChange:()=>y(e),className:"w-4 h-4"}),(0,a.jsxs)("span",{className:"ml-3 font-semibold text-green-900",children:[e," km"]})]},e))}),a.jsx("button",{onClick:w,disabled:_||!j,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-3 rounded-lg transition-colors",children:_?"Đang xử l\xfd...":g?"Cập nhật":"Đăng k\xfd"}),g&&(0,a.jsxs)("p",{className:"text-sm text-green-700 mt-3 text-center",children:["✓ Bạn đ\xe3 đăng k\xfd với mục ti\xeau ",g.target_km," km"]})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-2",children:["Closed"===t.status&&x.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[a.jsx("h3",{className:"text-2xl font-bold mb-4",children:"\uD83C\uDF81 Quay Thưởng May Mắn"}),a.jsx("div",{className:"space-y-4",children:x.map((e,t)=>(0,a.jsxs)("div",{className:`p-4 rounded-lg border-2 flex items-center gap-4 ${0===t?"bg-yellow-50 border-yellow-400":"bg-gray-50 border-gray-300"}`,children:[a.jsx("div",{className:`text-4xl font-bold w-12 text-center ${0===t?"text-yellow-600":"text-gray-600"}`,children:0===t?"\uD83E\uDD47":"\uD83E\uDD48"}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"font-bold text-gray-900",children:e.winner_profile?.full_name||"Anonymous"}),a.jsx("p",{className:"text-sm text-gray-600",children:e.prize_name})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[a.jsx("h3",{className:"text-2xl font-bold mb-6",children:"\uD83D\uDCCA Bảng Xếp Hạng"}),d.length>0?a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{className:"border-b-2 border-gray-300",children:[a.jsx("th",{className:"text-left py-3 px-2 font-bold text-gray-700",children:"#"}),a.jsx("th",{className:"text-left py-3 px-2 font-bold text-gray-700",children:"T\xean"}),a.jsx("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Qu\xe3ng Đường"}),a.jsx("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Pace Avg"}),a.jsx("th",{className:"text-right py-3 px-2 font-bold text-gray-700",children:"Hoạt động"})]})}),a.jsx("tbody",{children:d.map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[a.jsx("td",{className:"py-4 px-2",children:a.jsx("div",{className:"flex items-center justify-center",children:0===t?a.jsx("span",{className:"text-2xl",children:"\uD83E\uDD47"}):1===t?a.jsx("span",{className:"text-2xl",children:"\uD83E\uDD48"}):2===t?a.jsx("span",{className:"text-2xl",children:"\uD83E\uDD49"}):a.jsx("span",{className:"font-bold text-gray-600",children:t+1})})}),a.jsx("td",{className:"py-4 px-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.profile?.avatar_url?a.jsx("img",{src:e.profile.avatar_url,alt:e.profile.full_name,className:"w-8 h-8 rounded-full object-cover"}):a.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center",children:a.jsx("span",{className:"text-xs",children:"\uD83D\uDC64"})}),a.jsx("span",{className:"font-semibold text-gray-900",children:e.profile?.full_name||"Unknown"})]})}),(0,a.jsxs)("td",{className:"py-4 px-2 text-right",children:[(0,a.jsxs)("div",{className:"font-bold text-blue-600",children:[e.actual_km," km"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Target: ",e.target_km," km"]})]}),a.jsx("td",{className:"py-4 px-2 text-right",children:c(e.avg_pace_seconds)}),a.jsx("td",{className:"py-4 px-2 text-right text-gray-600",children:e.total_activities})]},e.user_id))})]})}):a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-gray-500",children:"Chưa c\xf3 người tham gia"})})]})]})]})})]}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"text-gray-600 text-lg",children:"Kh\xf4ng t\xecm thấy thử th\xe1ch"}),a.jsx(l.default,{href:"/challenges",className:"text-blue-600 hover:underline mt-4 inline-block",children:"← Quay lại danh s\xe1ch"})]})})}},7553:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var a=s(326),r=s(7577),l=s(434),n=s(5047);s(1579);let i=[{label:"Tổng quan",href:"/dashboard",icon:"\uD83D\uDCCA"},{label:"Bảng V\xe0ng",href:"/hall-of-fame",icon:"\uD83C\uDFC6"},{label:"Thử Th\xe1ch",href:"/challenges",icon:"\uD83C\uDFC3"},{label:"Sự Kiện",href:"/events",icon:"\uD83D\uDCC5"},{label:"Hồ Sơ",href:"/profile",icon:"\uD83D\uDC64"}],c=[{label:"Quản Trị",href:"/admin",icon:"⚙️",requiredRoles:["admin","mod_finance","mod_challenge","mod_member"]}];function d(){let e=(0,n.usePathname)(),[t,s]=(0,r.useState)(!1),[d,o]=(0,r.useState)(null),[x,h]=(0,r.useState)(!1),m=[...i,...c.filter(e=>!e.requiredRoles||e.requiredRoles.includes(d?.role||"member"))],u=t=>e===t;return t?a.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg md:hidden",children:(0,a.jsxs)("div",{className:"flex justify-around items-center h-16",children:[m.slice(0,5).map(e=>(0,a.jsxs)(l.default,{href:e.href,className:`flex flex-col items-center justify-center flex-1 h-full transition-colors ${u(e.href)?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900"}`,onClick:()=>h(!1),children:[a.jsx("span",{className:"text-xl mb-1",children:e.icon}),a.jsx("span",{className:"text-xs font-medium",children:e.label})]},e.href)),m.length>5&&(0,a.jsxs)("div",{className:"relative flex flex-col items-center justify-center flex-1 h-full",children:[(0,a.jsxs)("button",{onClick:()=>h(!x),className:`flex flex-col items-center justify-center transition-colors ${x?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900"}`,children:[a.jsx("span",{className:"text-xl mb-1",children:"⋯"}),a.jsx("span",{className:"text-xs font-medium",children:"More"})]}),x&&a.jsx("div",{className:"absolute bottom-full right-0 bg-white border border-gray-200 rounded-lg shadow-lg mb-2 w-40",children:m.slice(5).map(e=>(0,a.jsxs)(l.default,{href:e.href,className:`block px-4 py-2 transition-colors ${u(e.href)?"text-blue-600 bg-blue-50":"text-gray-700 hover:bg-gray-100"}`,onClick:()=>h(!1),children:[e.icon," ",e.label]},e.href))})]})]})}):(0,a.jsxs)("nav",{className:"hidden md:flex flex-col w-56 bg-white border-r border-gray-200 h-full shadow-sm sticky top-0",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[a.jsx("h1",{className:"text-2xl font-bold text-blue-600",children:"HLR Running"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Running Club"})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:m.map(e=>(0,a.jsxs)(l.default,{href:e.href,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${u(e.href)?"bg-blue-100 text-blue-600 font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:[a.jsx("span",{className:"text-xl",children:e.icon}),a.jsx("span",{children:e.label})]},e.href))}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:a.jsx("div",{className:"text-sm text-gray-600",children:(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["Role: ",a.jsx("span",{className:"text-blue-600 capitalize",children:d?.role||"member"})]})})})]})}},1579:(e,t,s)=>{"use strict";s.d(t,{O:()=>n});var a=s(7203);let r="https://jvnpxcwjfidrlqlfmuvl.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2bnB4Y3dqZmlkcmxxbGZtdXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODI3MTUsImV4cCI6MjA3OTk1ODcxNX0.9DQsgYHtU285oG2Twzr5mw71z4_5EiUDzry--bdf5lU";if(!r||!l)throw Error("Missing Supabase environment variables");let n=(0,a.eI)(r,l)},7525:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`/workspaces/hlr/app/challenges/[id]/page.tsx#default`)},2222:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>l});var a=s(9510);s(7272);let r=(0,s(8570).createProxy)(String.raw`/workspaces/hlr/components/Navigation.tsx#default`),l={title:"HLR Running Club",description:"Running club management system"};function n({children:e}){return a.jsx("html",{lang:"vi",children:a.jsx("body",{className:"bg-gray-50",children:(0,a.jsxs)("div",{className:"flex h-screen",children:[a.jsx(r,{}),a.jsx("main",{className:"flex-1 flex flex-col overflow-hidden",children:a.jsx("div",{className:"flex-1 overflow-y-auto pb-20 md:pb-0",children:e})})]})})})}},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,356],()=>s(2256));module.exports=a})();